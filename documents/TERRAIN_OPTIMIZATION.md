# åœ°å½¢ç³»ç»Ÿä¼˜åŒ–æ–‡æ¡£

## ä¼˜åŒ–æ¦‚è§ˆ

å°†åŸæœ‰çš„å®Œå…¨éšæœºåœ°å½¢ç”Ÿæˆæ”¹è¿›ä¸ºåŸºäºå¤šå±‚Perlinå™ªå£°çš„è‡ªç„¶åœ°å½¢ç”Ÿæˆç³»ç»Ÿï¼Œä½¿åœ°å½¢æ›´åŠ è¿è´¯å’ŒçœŸå®ã€‚

## ä¸»è¦æ”¹è¿›

### 1. å™ªå£°åœ°å½¢ç”Ÿæˆï¼ˆNoise-Based Terrainï¼‰

**ä¹‹å‰**ï¼šå®Œå…¨éšæœºç”Ÿæˆï¼Œåœ°å½¢åˆ†å¸ƒæ‚ä¹±æ— ç« 
```rust
let terrain_type = if rng.gen_ratio(1, 10) {
    TerrainType::Tree
} else if rng.gen_ratio(1, 15) {
    TerrainType::Stone
} // ... æ›´å¤šéšæœºåˆ¤æ–­
```

**ç°åœ¨**ï¼šä½¿ç”¨Perlinå™ªå£°ç®—æ³•ç”Ÿæˆè‡ªç„¶åœ°å½¢
```rust
struct TerrainGenerator {
    elevation: Perlin,   // é«˜åº¦å™ªå£°
    moisture: Perlin,    // æ¹¿åº¦å™ªå£°
    temperature: Perlin, // æ¸©åº¦å™ªå£°
    detail: Perlin,      // ç»†èŠ‚å™ªå£°
}
```

### 2. ç”Ÿç‰©ç¾¤ç³»ç³»ç»Ÿï¼ˆBiome Systemï¼‰

åŸºäºå¤šä¸ªå™ªå£°å±‚å†³å®šåœ°å½¢ç±»å‹ï¼š

- **é«˜åº¦ï¼ˆElevationï¼‰**ï¼šå†³å®šæ˜¯æ°´åŸŸã€å¹³åŸè¿˜æ˜¯å±±åœ°
  - `< -0.3`ï¼šæ°´åŸŸ
  - `> 0.5`ï¼šå±±è„‰/çŸ³åœ°
  - ä¸­é—´å€¼ï¼šå¹³åŸ/æ£®æ—

- **æ¹¿åº¦ï¼ˆMoistureï¼‰**ï¼šå½±å“æ¤è¢«åˆ†å¸ƒ
  - é«˜æ¹¿åº¦ + ä¸­ç­‰æµ·æ‹” â†’ æ£®æ—
  - ä½æ¹¿åº¦ â†’ çŸ³åœ°

- **æ¸©åº¦ï¼ˆTemperatureï¼‰**ï¼šåŒºåˆ†é«˜æµ·æ‹”åœ°å½¢
  - é«˜æ¸© + é«˜æµ·æ‹” â†’ å±±è„‰
  - ä½æ¸© + é«˜æµ·æ‹” â†’ çŸ³åœ°

### 3. æ²³æµç³»ç»Ÿï¼ˆRiver Systemï¼‰

```rust
fn is_river(&self, x: i32, y: i32) -> bool {
    let river_noise = self.moisture.get([x * 0.05, y * 0.05]);
    // æ²³æµæ²¿ç€æ¹¿åº¦å™ªå£°çš„ç‰¹å®šç­‰å€¼çº¿
    (river_noise.abs() < 0.05) && (elevation < 0.3)
}
```

æ²³æµæ²¿ç€åœ°å½¢è‡ªç„¶å½¢æˆï¼Œåˆ›é€ æ›´çœŸå®çš„æ°´ç³»ç½‘ç»œã€‚

### 4. èµ„æºç³»ç»Ÿå¢å¼º

#### åœ°å½¢èµ„æºå±æ€§

æ¯ä¸ªåœ°å½¢å—ç°åœ¨æœ‰ä¸¤ä¸ªèµ„æºç›¸å…³å±æ€§ï¼š

1. **èµ„æºå€ç‡ï¼ˆResource Multiplierï¼‰** - åŸºäºåœ°å½¢ç±»å‹
   - æ£®æ—ï¼š1.5xï¼ˆæœ¨æå’Œé£Ÿç‰©ä¸°å¯Œï¼‰
   - çŸ³åœ°ï¼š1.2xï¼ˆçŸ³å¤´è¾ƒå¤šï¼‰
   - å±±è„‰ï¼š1.8xï¼ˆçŸ¿çŸ³å’Œé‡‘å±æœ€å¤šï¼‰
   - æ°´åŸŸï¼š0.8xï¼ˆé’“é±¼æ•ˆç‡ç•¥ä½ï¼‰
   - è‰åœ°ï¼š1.0xï¼ˆæ ‡å‡†ï¼‰

2. **èµ„æºä¸°å¯Œåº¦ï¼ˆResource Richnessï¼‰** - åŸºäºç»†èŠ‚å™ªå£°
   - èŒƒå›´ï¼š0.8 - 1.5
   - åŠ¨æ€ç”Ÿæˆï¼Œå³ä½¿åŒç±»å‹åœ°å½¢èµ„æºé‡ä¹Ÿæœ‰å·®å¼‚

#### é‡‡é›†æ•ˆç‡è®¡ç®—

```rust
// å®é™…æ•ˆç‡ = åœ°å½¢å€ç‡ Ã— èµ„æºä¸°å¯Œåº¦
terrain_multiplier = terrain.terrain_type.resource_multiplier() 
                   * terrain.resource_richness;

// å·¥ä½œè¿›åº¦å¢é•¿
work_state.work_progress += time.delta_secs() * 0.5 * terrain_multiplier;

// èµ„æºäº§å‡º
let wood_yield = ((1.0 * terrain_multiplier) as i32).max(1) as u32;
```

### 5. è§†è§‰æ•ˆæœå¢å¼º

#### ASCIIå­—ç¬¦å¤šæ ·åŒ–
- è‰åœ°ï¼š`,` `.` `"` ï¼ˆæ›´å¤šå˜åŒ–ï¼‰
- æ ‘æœ¨ï¼š`&` `â™£` ï¼ˆæ··åˆæ˜¾ç¤ºï¼‰
- æ°´åŸŸï¼š`~` `â‰ˆ` ï¼ˆæ³¢æµªæ•ˆæœï¼‰
- å±±è„‰ï¼š`^` `â–²` ï¼ˆä¸åŒå±±å³°ï¼‰

#### é¢œè‰²æ¸å˜
```rust
let gradient_offset = rng.gen_range(-0.02..0.02);
// ä¸ºæ¯ä¸ªåœ°å—æ·»åŠ å¾®å°çš„é¢œè‰²å˜åŒ–
```

#### ç½‘æ ¼çº¿ä¼˜åŒ–
```rust
color: Color::srgba(0.0, 0.0, 0.0, 0.08)  // ä»0.1é™ä½åˆ°0.08ï¼Œæ›´ç»†è…»
```

## æŠ€æœ¯å®ç°

### ä¾èµ–åº“

æ–°å¢ `noise = "0.9"` åº“ç”¨äºPerlinå™ªå£°ç”Ÿæˆã€‚

### å™ªå£°å‚æ•°

```rust
scale = 0.1  // ä¸»è¦å™ªå£°ç¼©æ”¾ï¼ˆå€¼è¶Šå°åœ°å½¢è¶Šå¹³ç¼“ï¼‰

// å„å±‚å™ªå£°ä½¿ç”¨ä¸åŒç¼©æ”¾
elevation: scale = 0.1
moisture: scale = 0.08  (0.1 * 0.8)
temperature: scale = 0.12  (0.1 * 1.2)
detail: scale = 0.3  (0.1 * 3.0)
```

### ç§å­ç³»ç»Ÿ

```rust
let seed = rng.gen();  // éšæœºç§å­
let generator = TerrainGenerator::new(seed);
```

æ¯æ¬¡æ¸¸æˆç”Ÿæˆä¸åŒä½†è¿è´¯çš„åœ°å½¢ã€‚

## æ€§èƒ½å½±å“

- **ç”Ÿæˆæ—¶é—´**ï¼šç•¥æœ‰å¢åŠ ï¼ˆå™ªå£°è®¡ç®—ï¼‰ï¼Œä½†ä»åœ¨å¯æ¥å—èŒƒå›´
- **è¿è¡Œæ—¶æ€§èƒ½**ï¼šæ— å½±å“ï¼Œåœ°å½¢ç”Ÿæˆä»…åœ¨åˆå§‹åŒ–æ—¶è¿›è¡Œ
- **å†…å­˜å ç”¨**ï¼šå¢åŠ æå°‘ï¼ˆæ¯ä¸ªTerrainå¢åŠ ä¸€ä¸ªf32å­—æ®µï¼‰

## æ¸¸æˆæ€§æå‡

### 1. ç­–ç•¥æ·±åº¦
- ç©å®¶éœ€è¦å¯»æ‰¾èµ„æºä¸°å¯Œçš„åŒºåŸŸ
- ä¸åŒåœ°å½¢æœ‰ä¸åŒçš„èµ„æºäº§å‡º
- çŸ®äººå·¥ä½œæ•ˆç‡å—åœ°å½¢å½±å“

### 2. è§†è§‰ä½“éªŒ
- åœ°å½¢å‘ˆç°è‡ªç„¶åˆ†å¸ƒï¼ˆæ£®æ—æˆç‰‡ã€æ²³æµèœ¿èœ’ï¼‰
- æ›´åƒçœŸå®çš„ä¸–ç•Œåœ°å›¾
- ASCIIå­—ç¬¦æ›´å¤šæ ·åŒ–

### 3. æ¢ç´¢ä»·å€¼
- ä¸åŒåŒºåŸŸæœ‰ä¸åŒç‰¹è‰²
- æ‰¾åˆ°å¯ŒçŸ¿åŒºåŸŸæ›´æœ‰æˆå°±æ„Ÿ
- æ²³æµå’Œå±±è„‰ä½œä¸ºå¤©ç„¶åœ°æ ‡

## æœªæ¥æ‰©å±•

### é¢„ç•™åŠŸèƒ½ï¼ˆå·²æ·»åŠ æ¥å£ï¼‰

1. **ç§»åŠ¨é€Ÿåº¦ç³»ç»Ÿ**
   ```rust
   pub fn movement_speed(&self) -> f32  // ä¸åŒåœ°å½¢ç§»åŠ¨é€Ÿåº¦
   ```

2. **åœ°å½¢æè¿°**
   ```rust
   pub fn description(&self) -> &'static str  // UIæç¤ºä¿¡æ¯
   ```

3. **å¯è¡Œèµ°åˆ¤å®š**
   ```rust
   pub walkable: bool  // ç”¨äºæœªæ¥å¯»è·¯ç®—æ³•
   ```

### å¯èƒ½çš„æ”¹è¿›æ–¹å‘

- æ·»åŠ æ›´å¤šåœ°å½¢ç±»å‹ï¼ˆæ²™æ¼ ã€é›ªåœ°ã€æ²¼æ³½ç­‰ï¼‰
- åŠ¨æ€åœ°å½¢å˜åŒ–ï¼ˆçŸ®äººæŒ–æ˜æ”¹å˜åœ°å½¢ï¼‰
- åœ°å½¢é«˜åº¦çš„3Dè§†è§‰è¡¨ç°
- å­£èŠ‚ç³»ç»Ÿå½±å“åœ°å½¢å¤–è§‚
- åœ°ä¸‹æ´ç©´ç³»ç»Ÿ

## ä»£ç è´¨é‡

- âœ… é›¶ç¼–è¯‘è­¦å‘Š
- âœ… é›¶è¿è¡Œæ—¶é”™è¯¯
- âœ… æ‰€æœ‰æœªä½¿ç”¨ä»£ç éƒ½æœ‰ `#[allow(dead_code)]` æ ‡è®°å’Œè¯´æ˜
- âœ… ä»£ç æ³¨é‡Šæ¸…æ™°
- âœ… æ¨¡å—åŒ–è®¾è®¡

## ç¼–è¯‘ä¿¡æ¯

```
Compiling dwarf_fortress_game v0.1.0
Finished `release` profile [optimized] target(s) in 12.34s
```

å®Œç¾ç¼–è¯‘ï¼Œæ— ä»»ä½•è­¦å‘Šæˆ–é”™è¯¯ï¼ğŸ‰
