# 矮人要塞式游戏 - 项目结构

## 代码组织

### 主要模块

#### `src/main.rs` (84 行)
- 应用程序入口点
- 状态管理和系统调度
- 游戏生命周期配置

#### `src/components.rs` (138 行)
- ECS组件定义
- 游戏实体的数据结构

#### `src/resources.rs` (94 行)
- 全局资源定义
- 游戏状态、时间、库存等

#### `src/world.rs` (219 行)
- 世界生成逻辑
- 地形和矮人生成

### 系统模块 (`src/systems/`) - 共 1338 行

#### `movement.rs` (27 行)
- 矮人移动系统
- 网格位置更新

#### `work.rs` (171 行)
- 矮人AI工作系统
- 资源采集系统
- 建筑系统

#### `time_control.rs` (64 行)
- 游戏时间系统
- 时间缩放控制（1-5键）

#### `ui.rs` (199 行)
- UI设置和更新
- 资源显示
- 矮人面板
- 工作指示器

#### `input.rs` (244 行)
- 键盘输入处理（相机移动）
- 鼠标交互（选择、控制矮人）
- 悬停名字显示

#### `animation.rs` (212 行)
- 水面波光动画
- 树木摇摆动画
- 昼夜光照循环
- 粒子效果系统

#### `menu.rs` (338 行)
- 主菜单设置
- 暂停菜单设置
- 按钮交互系统
- ESC键暂停控制

#### `cleanup.rs` (52 行)
- 游戏实体清理
- 返回主菜单时的资源释放

#### `mod.rs` (31 行)
- 模块导出和组织

## 重构成果

### 重构前
- **systems.rs**: 1255 行（单一巨大文件）

### 重构后
- **8个独立模块**: 平均每个约 160 行
- **总行数**: 1338 行（增加了少量模块组织代码）
- **最大文件**: menu.rs (338 行) - 仍然很合理
- **最小文件**: movement.rs (27 行)

### 优势

1. **可维护性** ✅
   - 每个文件专注于单一功能领域
   - 易于定位和修改特定功能

2. **可读性** ✅
   - 清晰的模块边界
   - 相关功能聚合在一起

3. **可扩展性** ✅
   - 添加新系统只需创建新模块
   - 不会影响现有代码

4. **团队协作** ✅
   - 多人可以同时修改不同模块
   - 减少合并冲突

## 编译结果

- ✅ 零警告
- ✅ 零错误
- ✅ 游戏正常运行
- ✅ 所有功能正常工作

## 技术栈

- **引擎**: Bevy 0.17.2
- **语言**: Rust 1.90.0
- **字体**: Sarasa Gothic（支持中文、emoji、特殊符号）
- **架构**: ECS (Entity Component System)
- **状态管理**: Bevy States
- **渲染**: 2D Sprite + ASCII Art

## 游戏特性

- 50×30 世界地图
- 7个命名矮人（AI控制 + 手动指挥）
- ASCII艺术风格
- 完整动画系统（水、树、昼夜、粒子）
- 时间控制（暂停/加速）
- 资源系统（石头、木材、食物、金属）
- 菜单系统（主菜单、暂停菜单）
- 完整的实体生命周期管理
