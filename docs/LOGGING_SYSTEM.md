# 游戏日志系统文档

## 概述
游戏现在使用统一的日志系统,所有调试信息都通过 `GameLogger` 资源管理,并显示在游戏内的通知面板中。

## 功能特性

### 1. 日志级别
- **Debug**: 调试信息(仅在调试模式下显示)
- **Info**: 一般信息
- **Warning**: 警告信息
- **Error**: 错误信息

### 2. 日志存储
- 所有日志保存到 `game.log` 文件
- 内存中保留最近 100 条消息
- 带时间戳的日志记录

### 3. 游戏内通知面板
- 位置: 屏幕底部中央
- 显示: 最近 10 条日志消息
- 切换: 按 F4 键显示/隐藏

### 4. 调试控制
- **F2**: 切换调试模式 (开启/关闭调试消息)
- **F3**: 切换调试面板 (FPS、资源、矮人信息等)
- **F4**: 切换通知面板
- **F5**: 清除日志文件

## 已集成的日志事件

### 世界生成
- 初始化世界地图
- 生成新地图
- 恢复已生成的地图
- 设置出生点

### 矮人管理
- 生成矮人 (数量和位置)
- 恢复矮人状态
- 保存矮人状态
- 矮人位置查找警告/错误

### 资源采集
- 离线采集汇总
- 后台地块生产
- 全局模拟结果

### 游戏状态
- 返回主菜单
- 世界数据重置
- 调试模式切换

## 使用方法

在任何系统中使用日志:

```rust
pub fn your_system(
    mut logger: ResMut<crate::logger::GameLogger>,
) {
    // 普通信息
    logger.info("游戏开始".to_string());
    
    // 调试信息 (仅在调试模式显示)
    logger.debug(format!("当前位置: {:?}", position));
    
    // 警告
    logger.warning("资源不足".to_string());
    
    // 错误
    logger.error("无法生成矮人".to_string());
}
```

## 日志文件格式

```
[HH:MM:SS] [LEVEL] 消息内容
```

示例:
```
[23:40:49] [INFO] 初始化世界地图，种子: 564920440
[23:40:54] [INFO] 生成新地图: IVec2(10, 6)
[23:40:54] [INFO] 设置出生点: IVec2(10, 6)
[23:40:54] [INFO] 在出生点 IVec2(10, 6) 生成 7 个矮人
[23:41:00] [INFO] 调试模式已开启
```

## 技术实现

### GameLogger 资源
- 使用 `VecDeque` 存储消息队列
- 自动截断到最大消息数量
- 异步文件写入 (每条消息立即写入)

### 通知面板
- 600x150 像素面板
- 滚动显示最近消息
- 颜色编码:
  - Debug: 灰色
  - Info: 白色
  - Warning: 黄色
  - Error: 红色

### 调试模式
- 默认开启
- 可通过 F2 切换
- 影响 Debug 级别消息的显示

## 未来改进计划
- [ ] 添加日志搜索/过滤功能
- [ ] 支持日志导出
- [ ] 添加更多游戏事件的日志
- [ ] 优化文件写入性能 (批量写入)
- [ ] 添加日志文件大小限制和轮转
